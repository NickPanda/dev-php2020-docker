# Работа со сканером OpenVas на проекте toponao.ru

Проект размещен на shared-хостинг написан на php без использования фреймворкод и CMS.

## Отчет по сканированию проекта

По итогам сканировани была найдено 13 уязвимостей. Подробнее в `report-before.pdf`

## Решение и рекомендации по найденным уязвимостям

### Уязвимость 1. FTP Unencrypted Cleartext Login

_Порт: 21_

Решение: Включить FTPS или устанавливать соединение с помощью команды «AUTH TLS».

Вариант реализации: включить в конфигурции FTP прописать необходимость шифрования `TLSRequired on`

Используется shared-хостинг, то изменения не были внесены (так как у них используется для совместимости различных ftp-клиентов)

**не решено**

### Уязвимость 2 SSL/TLS: Report Weak Cipher Suites

_Порт: 21_

Проблема: слабые наборы шифров.

Решение: изменить конфигурацию, чтобы не использовались указаные в отчете шифры. 
(на стороне сервера требуется обновить систему и конфигурацию)

Реализация: на стороне shared-хостинга были внесены исправления

**решено**

### Уязвимость 3. HTTP Debugging Methods (TRACE/TRACK) Enabled

_Порт: 4443_

Решение: Выключить на веб-сервере метод HTTP: TRACE

Вариант реализации: в основной конфигурационный файла apache добавить строку: TraceEnabled off

Так как используется shared-хостинг, то изменения не были внесены.

**не решено**

### Уязвимость 4. SSL/TLS: Report Vulnerable Cipher Suites for HTTPS

_Порт: 4443_

Проблема: уязвимые наборы шифров для HTTPS.

Решение: изменить конфигурацию, чтобы не использовались указаные в отчете шифры. 
(на стороне сервера требуется обновить систему и конфигурацию)

На уровне веб-сервера (nginx) в конфигуратор можно добавить
```
    ssl_ciphers {список шифров, которые требуется отключить}
    add_header Strict-Transport-Security "max-age=31536000";
    ssl_protocols TLSv1.2;
```

**решено**

### Уязвимость 5. SSL/TLS: Report Weak Cipher Suites

_Порт: 4443_

_Аналогично уязвимости 2._

**решено**

### Уявизмость 6. SSL/TLS: Missing `secure` Cookie Attribute

_Порт: 443_

Решение: Set the 'secure' attribute for any cookies that are sent over a SSL/TLS connection.

Так как используется PHP, 
то в конфигурации PHP (php.ini) потребуется включить параметр `session.cookie_secure=On`,
либо в самом приложении через `ini_set()`.

В моем случае используется shared-хостинг на котором были сделаны след. настройки:
- Включен для домена стандартный режим CGI окружения
- Через него в php.ini добавлен параметр `session.cookie_secure=On`

**решено**

### Уявизмость 7. Sensitive File Disclosure (HTTP)

_Порт: 443_

Причина: файл с бекапом БД находится в публичном доступе

Решение: закрыть доступ или полностью удалить.

Реализация: закрыть через htaccess.

```
<Files ~ "\.(sql|dump|md)$">
  Order allow,deny
  Deny from all
</Files>
```

**решено**

### Уявизмость 8. Missing `httpOnly` Cookie Attribute

_Порт: 443_

Решение: Set the 'secure' attribute for any cookies that are sent over a SSL/TLS connection.

Так как используется PHP, 
то в конфигурации PHP (php.ini) потребуется включить параметр `session.cookie_httponly=On`,
либо в самом приложении через `ini_set()`.

В моем случае используется shared-хостинг на котором были сделаны след. настройки:
- Включен для домена стандартный режим CGI окружения (включен ранне в п. 6)
- Через него в php.ini добавлен параметр `session.cookie_httponly=On`

**решено**

### Уявизмость 9. HTTP Debugging Methods (TRACE/TRACK) Enabled

_Порт: 4343_

_Аналогично уязвимости 3._

**не решено**

### Уязвимость 10. SSL/TLS: Report Vulnerable Cipher Suites for HTTPS

_Порт: 4343_

_Аналогично уязвимости 4._

**решено**

### Уязвимость 11. SSL/TLS: Report Weak Cipher Suites

_Порт: 4343_

_Аналогично уязвимости 2._

**решено**

### Уязвимость 12. SSH Weak Encryption Algorithms Supported

_Порт: 4343_

Проблема: слабые алгоритмы шифрования для SSH.

Решение: Запретить использование указаных в отчете алгоритмы шифрования. 
(на стороне сервера требуется обновить систему и(или) конфигурацию)

**решено**

### Уязвимость 13. TCP timestamps

_Порт: 1024_

Решение: Отключить TCP timestamps.

Реализация для Linux: Добавить строку `net.ipv4.tcp_timestamps = 0` в файл `/etc/sysctl.conf`. Выполнить `sysctl -p` для применения настроек

**решено**

## Итого

**10/13** уязвимостей исправлены. Подробнее в `report-after.pdf`  

По решению уязвимостей указаны рекомендации и по возможности были решены

3 уязвимости на 443 порту удалось решить через настройки хостинга
Другие 7 уязвимостей внесены совместно с ТП.

4443 и 4343 - порты, которые использует shared-хостинг для внутренних целей
Уязвимости 1, 3, 9 на портах 21, 4443 и 4343 соответственно - не были исправлены, так как shared-хостинг
